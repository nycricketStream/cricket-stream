<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Cricket Pro Overlay</title>
<script src="https://js.pusher.com/8.2.0/pusher.min.js"></script>
<style>
body { margin:0; background:transparent; font-family:Arial; overflow:hidden; }

.scoreboard {
  position:absolute;
  bottom:5vh;
  left:50%;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.85);
  padding:2vh 4vw;
  border-radius:20px;
  text-align:center;
  color:white;
  min-width:40vw;
}

#tournament { font-size:2vh; margin-bottom:1vh; }
#teams { font-size:3vh; font-weight:bold; }
#score { font-size:2.5vh; }

.lower {
  position:absolute;
  bottom:20vh;
  left:5vw;
  background:#003366;
  padding:2vh 2vw;
  border-radius:12px;
  display:none;
  color:white;
  align-items:center;
}

.lower img {
  height:8vh;
  width:8vh;
  border-radius:50%;
  margin-right:1vw;
}

.sponsor-box {
  position:absolute;
  top:3vh;
  right:3vw;
}

.sponsor-box img {
  height:8vh;
}

.ticker {
  position:absolute;
  bottom:0;
  width:100%;
  background:black;
  color:white;
  padding:1vh;
  font-size:2vh;
}

.moment {
  position:absolute;
  top:40%;
  left:50%;
  transform:translate(-50%, -50%);
  font-size:10vh;
  font-weight:bold;
  display:none;
  color:yellow;
}

iframe {
  position:absolute;
  top:10vh;
  left:50%;
  transform:translateX(-50%);
  width:60vw;
  height:30vh;
  border:none;
  display:none;
}
</style>
</head>
<body>

<div class="scoreboard">
<div id="tournament"></div>
<div id="teams">Team A vs Team B</div>
<div id="score">0/0 (0.0)</div>
</div>

<div class="lower" id="lower">
<img id="playerImg">
<div>
<div id="playerName"></div>
<div id="playerStats"></div>
</div>
</div>

<div class="sponsor-box">
<img id="sponsorImg">
</div>

<div class="ticker" id="ticker"></div>

<div class="moment" id="momentText"></div>

<iframe id="cricFrame"></iframe>

<script>
const PUSHER_KEY = "40ce89af9ae13d222f51";
const PUSHER_CLUSTER = "us2";

const pusher = new Pusher(PUSHER_KEY, {
  cluster: PUSHER_CLUSTER,
});

const channel = pusher.subscribe("my-channel");

let sponsorList = [];
let sponsorIndex = 0;
let rotateInterval;

channel.bind("client-update-score", function(data){
  document.getElementById("tournament").innerText = data.tournament;
  document.getElementById("teams").innerText = data.teamA + " vs " + data.teamB;
  document.getElementById("score").innerText = data.score;
});

channel.bind("client-show-lower", function(data){
  document.getElementById("playerName").innerText = data.name;
  document.getElementById("playerStats").innerText = data.stats;
  document.getElementById("playerImg").src = data.image;
  document.getElementById("lower").style.display = "flex";
});

channel.bind("client-hide-lower", function(){
  document.getElementById("lower").style.display = "none";
});

channel.bind("client-update-sponsors", function(data){
  sponsorList = data.sponsors.split(",");
  document.getElementById("ticker").innerText = sponsorList.join("  |  ");
  document.getElementById("sponsorImg").src = sponsorList[0];

  if(data.rotateMode === "auto"){
    clearInterval(rotateInterval);
    rotateInterval = setInterval(()=>{
      sponsorIndex = (sponsorIndex+1)%sponsorList.length;
      document.getElementById("sponsorImg").src = sponsorList[sponsorIndex];
    }, 5000);
  }
});

channel.bind("client-update-cric", function(data){
  const frame = document.getElementById("cricFrame");
  if(data.cricToggle === "on"){
    frame.src = data.cricEmbed;
    frame.style.display = "block";
  } else {
    frame.style.display = "none";
  }
});

channel.bind("client-moment", function(data){
  const el = document.getElementById("momentText");
  el.innerText = data.type;
  el.style.display = "block";
  setTimeout(()=>{ el.style.display="none"; }, 3000);
});
</script>

</body>
</html>
