<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TV-Level Cricket Overlay</title>
<script src="https://js.pusher.com/8.2/pusher.min.js"></script>

<style>
body{
  margin:0;
  background:transparent;
  overflow:hidden;
  font-family:'Segoe UI','Montserrat',Arial,sans-serif;
}

/* SAFE ZONE */
.safe-zone{
  position:fixed;
  inset:4%;
  pointer-events:none;
}

/* LOWER THIRD */
#lowerThird{
  position:absolute;
  bottom:0;
  left:50%;
  transform:translate(-50%,120%);
  transition:transform .7s cubic-bezier(.22,.9,.3,1),opacity .5s;
  opacity:0;
}

.lt-panel{
  background:linear-gradient(180deg,#081a3a,#000814);
  border-radius:14px;
  padding:24px 44px;
  min-width:560px;
  box-shadow:0 22px 60px rgba(0,0,0,.95);
  border:1px solid rgba(255,255,255,.18);
  color:#fff;
  position:relative;
  overflow:hidden;
}

/* Shine Sweep */
#shine{
  position:absolute;
  top:0;
  left:-120%;
  width:60%;
  height:100%;
  background:linear-gradient(120deg,transparent,rgba(255,255,255,.25),transparent);
  transform:skewX(-25deg);
}

.lt-team{
  font-size:15px;
  font-weight:800;
  letter-spacing:.12em;
  color:#7dd3fc;
  margin-bottom:10px;
  text-transform:uppercase;
}

.lt-tag{
  background:linear-gradient(180deg,#fbbf24,#f59e0b);
  color:#000;
  font-weight:900;
  font-size:13px;
  padding:4px 16px;
  border-radius:4px;
  display:inline-block;
  margin-bottom:12px;
}

.lt-name{
  font-size:38px;
  font-weight:900;
  letter-spacing:.04em;
  text-transform:uppercase;
  text-shadow:0 3px 10px rgba(0,0,0,.9);
}

.lt-hand{
  font-size:15px;
  color:#e2e8f0;
  margin-top:8px;
  letter-spacing:.06em;
}

/* MANUAL SCORE */
#manualScore{
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  display:none;
}

.score-panel{
  background:linear-gradient(180deg,#081a3a,#000814);
  padding:16px 36px;
  border-radius:12px;
  font-weight:900;
  letter-spacing:.06em;
  color:#fff;
  box-shadow:0 18px 48px rgba(0,0,0,.9);
}

/* SPONSOR */
#sponsorBox{
  position:absolute;
  top:0;
  right:0;
  width:240px;
  height:70px;
  display:none;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.6);
  border-radius:10px;
  overflow:hidden;
}

#sponsorBox img{
  max-width:90%;
  max-height:90%;
}

/* MOMENT STINGER */
#momentStinger{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.75);
  backdrop-filter:blur(4px);
  opacity:0;
  pointer-events:none;
  transition:opacity .35s ease;
  z-index:15000;
}

#momentText{
  font-size:120px;
  font-weight:900;
  letter-spacing:.08em;
  text-transform:uppercase;
  transform:scale(.6);
  transition:transform .4s cubic-bezier(.22,.9,.3,1);
}

/* CONNECTION DOT */
#connectionDot{
  position:fixed;
  top:14px;
  left:14px;
  width:8px;
  height:8px;
  border-radius:50%;
  background:#facc15;
  z-index:20000;
}
</style>
</head>
<body>

<div class="safe-zone">

  <div id="lowerThird">
    <div class="lt-panel">
      <div id="shine"></div>
      <div class="lt-team" id="ltTeam"></div>
      <div class="lt-tag">NEW BATSMAN</div>
      <div class="lt-name" id="ltName"></div>
      <div class="lt-hand" id="ltHand"></div>
    </div>
  </div>

  <div id="manualScore">
    <div class="score-panel" id="scoreText"></div>
  </div>

  <div id="sponsorBox"></div>

</div>

<div id="momentStinger">
  <div id="momentText"></div>
</div>

<div id="connectionDot"></div>

<script>
const PUSHER_KEY = "12fcceaea77e52cf3626";
const pusher = new Pusher(PUSHER_KEY,{cluster:'us2'});
let channel;
let lastEventTime = Date.now();
let sponsorInterval;

const dot = document.getElementById('connectionDot');

function setStatus(state){
  if(state==='connected') dot.style.background='#22c55e';
  else if(state==='connecting') dot.style.background='#facc15';
  else dot.style.background='#ef4444';
}

pusher.connection.bind('connected',()=>setStatus('connected'));
pusher.connection.bind('connecting',()=>setStatus('connecting'));
pusher.connection.bind('disconnected',()=>setStatus('disconnected'));

/*setInterval(()=>{
  if(Date.now()-lastEventTime>15000){
    dot.style.background='#ef4444';
  }
},5000);*/

function subscribe(){
  channel = pusher.subscribe('broadcast');

  channel.bind_global(()=>{ lastEventTime = Date.now(); });

  /* PLAYER LOWER THIRD */
  channel.bind('client-player',data=>{
    if(!data) return;

    ltTeam.textContent=data.team||'';
    ltName.textContent=data.name||'';
    ltHand.textContent=data.hand||'';

    const lt=document.getElementById('lowerThird');
    lt.style.opacity='1';
    lt.style.transform='translate(-50%,0)';

    shine.animate([{left:'-120%'},{left:'130%'}],
      {duration:900,easing:'ease-out'});

    setTimeout(()=>{
      lt.style.opacity='0';
      lt.style.transform='translate(-50%,120%)';
    },7200);
  });

  /* MANUAL SCORE */
  channel.bind('client-manualScore',data=>{
    manualScore.style.display='block';
    scoreText.textContent=
      `${data.score||''} | ${data.overs||''}`;
  });

  channel.bind('client-score',data=>{
    if(data.auto){
      manualScore.style.display='none';
    }
  });

  /* SPONSORS */
  channel.bind('client-sponsor',data=>{
    if(!data.enabled){
      sponsorBox.style.display='none';
      clearInterval(sponsorInterval);
      return;
    }

    sponsorBox.style.display='flex';
    const list=data.list||[];
    if(!list.length) return;

    let i=0;
    sponsorBox.innerHTML=`<img src='${list[0]}'>`;

    clearInterval(sponsorInterval);
    sponsorInterval=setInterval(()=>{
      i=(i+1)%list.length;
      sponsorBox.innerHTML=`<img src='${list[i]}'>`;
    },(data.interval||8)*1000);
  });

  /* MOMENT ANIMATIONS */
  channel.bind('client-moment',data=>{
    if(!data || !data.type) return;

    const stinger=document.getElementById('momentStinger');
    const text=document.getElementById('momentText');

    let color='#fbbf24';
    if(data.type==='SIX') color='#22c55e';
    if(data.type==='WICKET') color='#ef4444';

    text.textContent=data.type;
    text.style.color=color;

    stinger.style.opacity='1';
    text.style.transform='scale(1)';

    setTimeout(()=>{
      stinger.style.opacity='0';
      text.style.transform='scale(.6)';
    },2500);
  });

}

subscribe();
</script>
</body>
</html>
